{"version":3,"file":"orby-router.js","sources":["../src/index.js"],"sourcesContent":["import { h, useState, useEffect, useContext } from \"@orby/core\";\r\nimport { create, compare, resolve, join } from \"path-path\";\r\n\r\nlet subscribers = [];\r\n\r\nexport let NameSpace = \"__orby_router_namespace__\";\r\n\r\nexport let history = {\r\n    path: \"\",\r\n    getPath() {\r\n        return window.location.pathname + location.search;\r\n    },\r\n    setPath(path) {\r\n        window.history.pushState({}, \"\", path);\r\n        dispatch(path);\r\n    },\r\n    setup() {\r\n        window.addEventListener(\"popstate\", event => {\r\n            dispatch(this.getPath());\r\n        });\r\n    }\r\n};\r\n\r\nexport function subscribe(handler) {\r\n    if (!history.path) {\r\n        history.path = history.getPath();\r\n        history.setup();\r\n    }\r\n    handler(history.path);\r\n    subscribers.push(handler);\r\n    return () => {\r\n        subscribers.splice(subscribers.indexOf(handler) >>> 0, 1);\r\n    };\r\n}\r\n\r\nexport function dispatch(path) {\r\n    history.path = path;\r\n    subscribers.forEach(handler => handler(path));\r\n}\r\n\r\nexport function useRouter(path, global) {\r\n    let [state, setState] = useState(false),\r\n        group = useContext(NameSpace) || \"\";\r\n\r\n    path = global ? path : join(group, path);\r\n\r\n    useEffect(() => {\r\n        let route = create(path);\r\n        return subscribe(currentPath => {\r\n            let params = compare(route, currentPath);\r\n            setState(params);\r\n        });\r\n    }, path);\r\n\r\n    return state;\r\n}\r\n\r\nfunction Layer(props) {\r\n    return props.use;\r\n}\r\n\r\nexport function useRedirect(path, global) {\r\n    let group = useContext(NameSpace) || \"\";\r\n\r\n    path = global ? path : join(group, path);\r\n    return event => {\r\n        if (event && event.preventDefault) {\r\n            event.preventDefault();\r\n        }\r\n        history.setPath(resolve(history.path, path));\r\n    };\r\n}\r\n\r\nexport function Group(props, context) {\r\n    let group = context[NameSpace] || \"\";\r\n\r\n    return (\r\n        <Layer\r\n            context={{ [NameSpace]: join(group, props.path) }}\r\n            use={props.children[0]}\r\n        />\r\n    );\r\n}\r\n\r\nexport function Route(props) {\r\n    let params = useRouter(props.path);\r\n\r\n    return params ? props.children[0](params) : \"\";\r\n}\r\n\r\nexport function Link({ path, children, ...props }) {\r\n    let redirect = useRedirect(path);\r\n    return (\r\n        <a {...props} href={path} onClick={redirect}>\r\n            {children}\r\n        </a>\r\n    );\r\n}\r\n\r\nexport default {\r\n    Route,\r\n    Group,\r\n    Link\r\n};\r\n"],"names":["let","subscribers","NameSpace","history","path","getPath","window","location","pathname","search","setPath","pushState","dispatch","setup","addEventListener","event","this","subscribe","handler","push","splice","indexOf","forEach","useRouter","global","useState","group","useContext","join","useEffect","route","create","currentPath","params","compare","setState","state","Layer","props","use","useRedirect","preventDefault","resolve","Group","context"],"mappings":"mDAGAA,IAAIC,EAAc,GAEPC,EAAY,4BAEZC,EAAU,CACjBC,KAAM,GACNC,mBACI,OAAOC,OAAOC,SAASC,SAAWD,SAASE,QAE/CC,iBAAQN,GACJE,OAAOH,QAAQQ,UAAU,GAAI,GAAIP,GACjCQ,EAASR,IAEbS,4BACIP,OAAOQ,iBAAiB,oBAAYC,GAChCH,EAASI,EAAKX,eAKnB,SAASY,EAAUC,GAOtB,OANKf,EAAQC,OACTD,EAAQC,KAAOD,EAAQE,UACvBF,EAAQU,SAEZK,EAAQf,EAAQC,MAChBH,EAAYkB,KAAKD,cAEbjB,EAAYmB,OAAOnB,EAAYoB,QAAQH,KAAa,EAAG,IAIxD,SAASN,EAASR,GACrBD,EAAQC,KAAOA,EACfH,EAAYqB,iBAAQJ,UAAWA,EAAQd,KAGpC,SAASmB,EAAUnB,EAAMoB,GAC5B,MAAwBC,YAAS,iBAC7BC,EAAQC,aAAWzB,IAAc,GAYrC,OAVAE,EAAOoB,EAASpB,EAAOwB,OAAKF,EAAOtB,GAEnCyB,uBACI7B,IAAI8B,EAAQC,SAAO3B,GACnB,OAAOa,WAAUe,GACbhC,IAAIiC,EAASC,UAAQJ,EAAOE,GAC5BG,EAASF,MAEd7B,GAEIgC,EAGX,SAASC,EAAMC,GACX,OAAOA,EAAMC,IAGV,SAASC,EAAYpC,EAAMoB,GAC9BxB,IAAI0B,EAAQC,aAAWzB,IAAc,GAGrC,OADAE,EAAOoB,EAASpB,EAAOwB,OAAKF,EAAOtB,YAC5BW,GACCA,GAASA,EAAM0B,gBACf1B,EAAM0B,iBAEVtC,EAAQO,QAAQgC,UAAQvC,EAAQC,KAAMA,KAIvC,SAASuC,EAAML,EAAOM,SAGzB,wCAFYA,EAAQ1C,IAAc,uFAgBC+B,iQA1FvC"}